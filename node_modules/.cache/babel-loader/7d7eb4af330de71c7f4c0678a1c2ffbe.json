{"ast":null,"code":"var _jsxFileName = \"/Users/shabeerhussain/ironhack/labs/proj3/client/src/components/main.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport Product from './product';\n\nclass Main extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      products: [],\n      cart: {},\n      total: 0,\n      loading: false\n    };\n    this.user = JSON.parse(localStorage.getItem('user'));\n    this.cartObject = JSON.parse(localStorage.getItem('cart'));\n    this.totalObject = parseFloat(localStorage.getItem('total'));\n\n    this.addToCart = item => {\n      console.log(this.state);\n      const stateCopy = { ...this.state\n      };\n      let {\n        cart,\n        total\n      } = stateCopy;\n      cart[item._id] = cart[item._id] + 1 || 1;\n      total = total + parseFloat(item['price']);\n      this.setState({ ...stateCopy,\n        cart,\n        total\n      });\n      localStorage.setItem('cart', JSON.stringify(cart));\n    };\n\n    this.removeCartItem = (item, key) => {\n      const stateCopy = { ...this.state\n      };\n      let {\n        cart,\n        total\n      } = stateCopy;\n      total = 0 || total - parseFloat(item['price']) * cart[key];\n      delete cart[key];\n      this.setState({ ...stateCopy,\n        cart,\n        total\n      });\n      localStorage.setItem('cart', JSON.stringify(cart));\n    };\n\n    this.createBooking = async () => {\n      const items = Object.keys(this.state.cart);\n      const total = this.state.total;\n      const user_id = this.user.user._id;\n      this.setState({ ...this.state,\n        loading: true\n      });\n\n      try {\n        const user = await fetch('http://localhost:3001/orders', {\n          method: 'POST',\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            items,\n            total,\n            user_id\n          })\n        }).then(data => data.json());\n        this.setState({ ...this.state,\n          loading: false\n        });\n        console.log(user);\n        localStorage.removeItem('cart');\n        this.setState({ ...this.state,\n          cart: {},\n          total: 0,\n          loading: false\n        });\n        alert('Booking Success');\n        this.props.history.push('/main');\n      } catch (error) {\n        this.setState({ ...this.state,\n          loading: false\n        });\n        alert(error);\n      }\n    };\n\n    this.logout = () => {\n      localStorage.removeItem('user');\n      this.props.history.push('/login');\n    };\n  }\n\n  componentDidMount() {\n    fetch('http://localhost:3001/items').then(data => data.json()).then(data => {\n      this.setState({ ...this.state,\n        products: data\n      });\n\n      if (this.cartObject) {\n        console.log('here');\n        this.setState({ ...this.state,\n          cart: this.cartObject,\n          total: this.totalObject\n        });\n        console.log(this.state);\n      }\n    });\n  }\n\n  componentDidUpdate() {\n    localStorage.setItem('total', this.state.total);\n  }\n\n  render() {\n    var _this$user, _this$user$user, _this$user$user2, _this$user2, _this$user2$user, _this$user3, _this$user3$user;\n\n    const {\n      products,\n      cart,\n      total\n    } = this.state;\n    if (this.state.loading) return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 21\n      }\n    }, \"loading...\");\n    return /*#__PURE__*/React.createElement(\"div\", {\n      classname: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }\n    }, ((_this$user = this.user) === null || _this$user === void 0 ? void 0 : (_this$user$user = _this$user.user) === null || _this$user$user === void 0 ? void 0 : _this$user$user.email) ? /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 46\n      }\n    }, (_this$user$user2 = this.user.user) === null || _this$user$user2 === void 0 ? void 0 : _this$user$user2.email, \" \", /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.logout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 76\n      }\n    }, \"Logout\"), \" \") : '', ((_this$user2 = this.user) === null || _this$user2 === void 0 ? void 0 : (_this$user2$user = _this$user2.user) === null || _this$user2$user === void 0 ? void 0 : _this$user2$user.userType) == 2 ? /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => this.props.history.push('/addproducts'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 53\n      }\n    }, \"Add Item\") : '')), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 21\n      }\n    }, products.map(product => /*#__PURE__*/React.createElement(Product, {\n      key: product._id,\n      addToCart: this.addToCart,\n      item: product,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 21\n      }\n    }, \"Cart\"), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 6\n      }\n    }, Object.keys(cart).map(item => {\n      const product = products.find(p => p._id == item);\n      return /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 36\n        }\n      }, product.name, \" ... \", cart[item], \" \", /*#__PURE__*/React.createElement(\"a\", {\n        href: \"#\",\n        onClick: () => this.removeCartItem(product, item),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 72\n        }\n      }, \"x\"));\n    })), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 6\n      }\n    }), /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 6\n      }\n    }, \"Total: \", total, \" \"), this.state.total > 0 ? ((_this$user3 = this.user) === null || _this$user3 === void 0 ? void 0 : (_this$user3$user = _this$user3.user) === null || _this$user3$user === void 0 ? void 0 : _this$user3$user.email) ? /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: this.createBooking,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 68\n      }\n    }, \"Create Booking\") : /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary\",\n      onClick: () => this.props.history.push('/login'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 159\n      }\n    }, \"Signin to Create Booking\") : '')));\n  }\n\n}\n\nexport default withRouter(Main);","map":{"version":3,"sources":["/Users/shabeerhussain/ironhack/labs/proj3/client/src/components/main.js"],"names":["React","Component","withRouter","Product","Main","constructor","props","state","products","cart","total","loading","user","JSON","parse","localStorage","getItem","cartObject","totalObject","parseFloat","addToCart","item","console","log","stateCopy","_id","setState","setItem","stringify","removeCartItem","key","createBooking","items","Object","keys","user_id","fetch","method","headers","body","then","data","json","removeItem","alert","history","push","error","logout","componentDidMount","componentDidUpdate","render","email","userType","map","product","find","p","name"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport {withRouter} from 'react-router-dom'\r\nimport Product from './product';\r\n class Main extends Component {\r\n     \r\n    state = { products: [], cart: {}, total:0,loading:false };\r\n    user = JSON.parse(localStorage.getItem('user'));\r\n    cartObject = JSON.parse(localStorage.getItem('cart'))\r\n    totalObject = parseFloat(localStorage.getItem('total'))\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t\r\n    }\r\n    \r\n\r\n\r\n\tcomponentDidMount() {\r\n\t\tfetch('http://localhost:3001/items')\r\n\t\t\t.then((data) => data.json())\r\n            .then((data) => {this.setState({ ...this.state, products: data });\r\n            if(this.cartObject){\r\n                console.log(('here'))\r\n                \r\n                this.setState({...this.state,cart:this.cartObject,total:this.totalObject})\r\n                console.log(this.state)\r\n            }\r\n        });\r\n           \r\n    }\r\n    \r\n    componentDidUpdate(){\r\n        localStorage.setItem('total',this.state.total)\r\n    }\r\n\r\n\taddToCart = (item) => {\r\n        console.log(this.state);\r\n        const stateCopy = { ...this.state };\r\n        let {cart,total} = stateCopy;\r\n        cart[item._id] = cart[item._id] + 1 || 1;\r\n        total = total+parseFloat(item['price']);\r\n        this.setState({...stateCopy,cart,total});\r\n        localStorage.setItem('cart',JSON.stringify(cart));\r\n       \r\n    }\r\n    \r\n    removeCartItem = (item,key) => {\r\n        const stateCopy = { ...this.state };\r\n        let {cart,total} = stateCopy;\r\n        total = 0 || total - (parseFloat(item['price'])*cart[key]);\r\n        delete cart[key];\r\n        this.setState({...stateCopy,cart,total});\r\n        localStorage.setItem('cart',JSON.stringify(cart));\r\n      \r\n    }\r\n\r\n    createBooking = async () => {\r\n       const items = Object.keys(this.state.cart);\r\n       const total = this.state.total;\r\n       const user_id = this.user.user._id;\r\n       this.setState({...this.state,loading:true})\r\n        try {\r\n            const user = await fetch('http://localhost:3001/orders',{method:'POST',headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },body:JSON.stringify({items,total,user_id})}).then(data=>data.json());\r\n        this.setState({...this.state,loading:false})\r\n        console.log(user)\r\n      \r\n        localStorage.removeItem('cart');\r\n        this.setState({...this.state,cart: {}, total:0,loading:false})\r\n        alert('Booking Success')\r\n        this.props.history.push('/main');    \r\n     \r\n        } catch (error) {\r\n        this.setState({...this.state,loading:false})\r\n\r\n            alert(error);\r\n        }\r\n\r\n        \r\n    }\r\n\r\n    logout = () => {\r\n        localStorage.removeItem('user');\r\n        this.props.history.push('/login');\r\n    }\r\n\r\n\trender() {\r\n\r\n\t\tconst {\r\n\t\t\tproducts,\r\n\t\t\tcart,total\r\n        } = this.state;\r\n\r\n        \r\n        if(this.state.loading)\r\n            return (<div>loading...</div>)\r\n\t\treturn (\r\n\t\t\t<div classname=\"container\">\r\n                \r\n                <div className=\"row\">\r\n                    <div className=\"col-12\">\r\n\r\n                <b>\r\n                    {this.user?.user?.email?(<span>{this.user.user?.email} <button onClick={this.logout}>Logout</button> </span>):''}\r\n                    {this.user?.user?.userType==2?( <button onClick={() => this.props.history.push('/addproducts')}>Add Item</button>):''}\r\n                    </b>\r\n\r\n                    </div>\r\n\r\n\t\t\t\t<div className=\"col-10\">\r\n                    <div className=\"row\">\r\n\r\n\t\t\t\t\t{products.map((product) => (\r\n\t\t\t\t\t\t<Product key={product._id} addToCart={this.addToCart} item={product}></Product>\r\n\t\t\t\t\t))}\r\n                    </div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col-2\">\r\n                    <h3>Cart</h3>\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t{\r\n                            Object.keys(cart).map(item=>{\r\n                                const product = products.find(p=>p._id == item);\r\n                            return <li>{product.name} ... {cart[item]} <a href=\"#\" onClick={()=>this.removeCartItem(product,item)}>x</a></li>\r\n                            })\r\n                        }\r\n\t\t\t\t\t</ul>\r\n\r\n\t\t\t\t\t<hr></hr>\r\n\t\t\t\t\t<b>Total: {total} </b>\r\n                    {   this.state.total>0?this.user?.user?.email?(<button className=\"btn btn-primary\" onClick={this.createBooking}>Create Booking</button>):(<button className=\"btn btn-primary\" onClick={()=>this.props.history.push('/login')}>Signin to Create Booking</button>):''\r\n                    }\r\n                    \r\n\r\n\t\t\t\t</div>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n\r\nexport default withRouter(Main)"]},"metadata":{},"sourceType":"module"}